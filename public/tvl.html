<!DOCTYPE html>
<html>
<head>
<title>Total Locked Value</title> 
</head>
<link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?family=Rubik:wght@300&display=swap" rel="stylesheet">
<style>
    body {
        font-family: 'Rubik', sans-serif;
    }
    .header {
        border-bottom: 1pt solid black;
    }
    .center {
        text-align: center;
    }
    .snowballs {
        background-color: #33A9FF;
    }
    .as_of {
        text-align: right;
        font-size: smaller;
    }    
    .money {
        text-align:right;
    }
    .token {
        height: 24px;
        width: 24px;
    }
</style>
<template id="pair_row">
    <tr>
        <td class="center"></td>
        <td class="center"></td>
        <td class="money"></td>
      </tr>
</template>
<template id="summary_row">
    <tr>
        <td colspan="4" class="center"></td>
    </tr>
</template>
<template id="pair_table">
    <table>
        <thead>
            <tr class="header">
                <td colspan="2"><div class="center">Total Locked Value</div></td>
                <td class="money"></td>
            </tr>          
        </thead>
        <tbody></tbody>
    </table>
</template>
<body>
    <script>

        let nf = new Intl.NumberFormat('en-US');

        fetch('/tvl.json').then(function (response) {
            let t = document.querySelector('#pair_table').content.cloneNode(true);
            document.body.appendChild(t);
            return response.json();
        }).then(function (info) {            
            document.querySelector('.money').innerHTML = nf.format(info.locked_value);
            let rt = document.querySelector('#pair_row')    
            info.pairs.forEach(p => {
                console.log('pair:', p)
                let row = rt.content.cloneNode(true);
                let row_td = row.querySelectorAll('td');
                row_td[0].innerHTML = `<a target="_blank" href="https://info.pangolin.exchange/#/token/${p.token0.token}"><img class="token" src="assets/avalanche-tokens/${p.token0.token}/logo.png"></a>`
                row_td[1].innerHTML = `<a target="_blank" href="https://info.pangolin.exchange/#/token/${p.token1.token}"><img class="token" src="assets/avalanche-tokens/${p.token1.token}/logo.png"></a>`
                row_td[2].textContent = nf.format(p.locked_value);                
                document.querySelector("tbody").appendChild(row)
            });
            let summary = document.querySelector('#summary_row').content.cloneNode(true);            
            let summary_td = summary.querySelectorAll('td');        
            summary_td[0].innerHTML = 'as of: ' + new Date(info.date).toLocaleTimeString()
            document.querySelector("tbody").appendChild(summary)
            console.log('summary', summary)
        });        
    </script>
</body>
</html>