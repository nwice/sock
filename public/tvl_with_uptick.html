<!DOCTYPE html>
<html>

<head>
    <title>Total Value Locked</title>
</head>
<link rel="preconnect" href="https://fonts.gstatic.com">
<link href="https://fonts.googleapis.com/css2?family=Rubik:wght@300&display=swap" rel="stylesheet">
<link href="assets/site.css" rel="stylesheet">
<style>
</style>
<template id="tvl_row">
    <tr>
        <td class="center"></td>
        <td class="center"></td>
        <td class="right"></td>
    </tr>
</template>
<template id="tvl_summary_row">
    <tr id="summary">
        <td colspan="4" class="center"></td>
    </tr>
</template>
<template id="tvl_table">
    <table id="tvl">
        <thead>
            <tr class="header">
                <td colspan="2">
                    <div class="center head">Total Value Locked</div>
                </td>
                <td class="right" id="total"></td>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</template>

<body>
    <script>

        let nf = new Intl.NumberFormat('en-US');

        function display(info) {
            document.querySelector('#total').innerHTML = nf.format(info.locked_value);
            let rt = document.querySelector('#pair_row')
            info.pairs.forEach(p => {
                console.log('pair:', p)
                if (true) {
                    let row = rt.content.cloneNode(true);
                    row.setAttribute('id', p.token0.token + '_' + p.token1.token)
                    let row_td = row.querySelectorAll('td');
                    row_td[0].innerHTML = `<a target="_blank" href="https://info.pangolin.exchange/#/token/${p.token0.token}"><img class="token" src="assets/avalanche-tokens/${p.token0.token}/logo.png"></a>`
                    row_td[1].innerHTML = `<a target="_blank" href="https://info.pangolin.exchange/#/token/${p.token1.token}"><img class="token" src="assets/avalanche-tokens/${p.token1.token}/logo.png"></a>`
                    row_td[2].textContent = nf.format(p.locked_value);
                    document.querySelector("tbody").appendChild(row)
                } else {
                    console.log('already have');
                }
            });
            
        }

        fetch('/tvl.json').then(function (response) {
            let t = document.querySelector('#pair_table').content.cloneNode(true);
            document.body.appendChild(t);
            return response.json();
        }).then(function (info) {
            display(info)
            let summary = document.querySelector('#summary_row').content.cloneNode(true);
            let summary_td = summary.querySelectorAll('td');
            summary_td[0].innerHTML = new Date(info.date).toLocaleTimeString()
            document.querySelector("tbody").appendChild(summary)

            console.log('summary', summary)
        }).catch(function (err) {
            console.log('tvl error:', err);
            document.querySelector('#total').innerHTML = "⛷️";
            document.querySelector('#total').classList.add('error');
        });        
    </script>
</body>

</html>